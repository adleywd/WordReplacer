@page "/"
@using WordReplacer.WebApp.Pages.MainSections
@using WordReplacer.WebApp.Services
@inject IStringLocalizer<GeneralResource> Localizer
@inject IDocumentProcessingService DocumentProcessingService

@* <PresetsComponent @bind-Document="_doc" /> *@

<MudPaper Width="100%" Class="mt-5 mb-5 pb-5 pt-5" Elevation="5">
    <MudContainer>
        <UploadFileComponent @bind-Files="_doc.Files" />
        <MudDivider DividerType="DividerType.FullWidth" Class="mt-3 mb-3" />
        <AddTextToReplaceComponent @bind-Document="_doc"/>
    </MudContainer>
</MudPaper>
<MudDivider DividerType="DividerType.FullWidth" Class="mt-3 mb-3" />
<MudPaper Width="100%" Class="mt-5 mb-5 pb-5 pt-5" Elevation="5">
    <MudContainer>
        <ReplacementTextComponent @bind-Document="_doc" />
        @if (ShouldDisplayReplacementButtons)
        {
            <MudStack Row="true" AlignItems="AlignItems.End" Justify="Justify.FlexEnd" Class="mt-5">
                <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="ClearReplacements">
                    Clear all replacements
                </MudButton>
                <MudButton 
                    Variant="Variant.Filled" 
                    Color="Color.Primary"
                    Disabled="@DoNotHaveFiles"
                    OnClick="@HandleWordReplacementAsync">
                        @ReplaceText()
                </MudButton>
            </MudStack>
        }
    </MudContainer>
</MudPaper>
@code {
    private Document _doc = new();

    private bool DoNotHaveFiles => _doc.Files.Count == 0;
    private bool _isProcessingReplacements = false;
    
    private bool ShouldDisplayReplacementButtons => _doc.DocumentValues.Count > 0;
    
    private string ReplaceText()
    {
        if (DoNotHaveFiles)
        {
            return "Add files to begin replacing";
        }

        if (_isProcessingReplacements)
        {
            return Localizer["btnReplaceTextReplacing"];
        }
        
        return Localizer["btnReplaceTextDefault"];
    } 
    
    private async Task HandleWordReplacementAsync()
    {
        await DocumentProcessingService.ReplaceWordsAsync(_doc);
    }

    private void ClearReplacements()
    {
        _doc.DocumentValues.Clear();
        StateHasChanged();
    }
}
